# ---------------------------------------------------------------------------------------------------------------------------------------------------"
# ---------------------------------------------------------------------------------------------------------------------------------------------------"
# ---------------------------------------------------------------------------------------------------------------------------------------------------"
# Training Dashboard
#
# V1.0 
#
# Â©2020 nikh@ch.ibm.com
# ---------------------------------------------------------------------------------------------------------------------------------------------------"
# ---------------------------------------------------------------------------------------------------------------------------------------------------"
# ---------------------------------------------------------------------------------------------------------------------------------------------------"
# ---------------------------------------------------------------------------------------------------------------------------------------------------"

source ./0_config.sh

# ---------------------------------------------------------------------------------------------------------------------------------------------------"
# ---------------------------------------------------------------------------------------------------------------------------------------------------"
# Do Not Edit Below
# ---------------------------------------------------------------------------------------------------------------------------------------------------"
# ---------------------------------------------------------------------------------------------------------------------------------------------------"
echo "${GREEN}***************************************************************************************************************************************************${NC}"
echo "${GREEN}***************************************************************************************************************************************************${NC}"
echo ""
echo " ${ORANGE}${rocket} Kubernetes Workshop Series ${NC}"
echo ""
echo "${GREEN}***************************************************************************************************************************************************${NC}"
echo "${GREEN}***************************************************************************************************************************************************${NC}"
echo " ${CYAN}    Setting up your Personal Training Environment $DO_NAM ${NC}"
echo " ${CYAN}    --------------------------------------------- $DO_NAM ${NC}"
echo " ${NC}    The following steps will create your web-based Personal Training Environment $DO_NAM ${NC}"
echo " ${NC}    You will have to enter a name that will be used to show your progress in the Instructor Dashboard $DO_NAM ${NC}"
echo "${GREEN}***************************************************************************************************************************************************${NC}"
echo "  "
echo "  "
echo "  "



# ------------------------------------------------------------------------------------------------------------------------------------------------------------------------
# ------------------------------------------------------------------------------------------------------------------------------------------------------------------------
# GET PARAMETERS
# ------------------------------------------------------------------------------------------------------------------------------------------------------------------------
# ------------------------------------------------------------------------------------------------------------------------------------------------------------------------
echo "${CYAN}***************************************************************************************************************************${NC}"
echo "${CYAN}---------------------------------------------------------------------------------------------------------------------------${NC}"
echo " ${PURPLE}${magnifying} Please enter your name ${NC}"
echo "${CYAN}---------------------------------------------------------------------------------------------------------------------------${NC}"

        read -p "Name:" DO_NAM
        if [[ $DO_NAM == "" ]]; then
          echo "${RED}${cross} Aborted: ${ORANGE}Please enter your name so that we can better assist you${NC}"
          exit 2
        else
            DO_NAM=${DO_NAM// /_}
        fi

echo "${CYAN}***************************************************************************************************************************${NC}"
echo "${CYAN}---------------------------------------------------------------------------------------------------------------------------${NC}"
echo " ${PURPLE}${magnifying} Welcome $DO_NAM ${NC}"
echo "${CYAN}---------------------------------------------------------------------------------------------------------------------------${NC}"
echo "${GREEN}***************************************************************************************************************************************************${NC}"
echo "  "
echo " ${CYAN} Preparing your Personal Training Environment${NC}"

        rm -f ~/training/dashboard/fscollector_student_$DO_NAM.yaml > /dev/null
        cp ~/training/dashboard/fscollector_student.yaml ~/training/dashboard/fscollector_student_deploy.yaml

        sed -i "s@TRAINING_NAME@$DO_NAM@" ~/training/dashboard/fscollector_student_deploy.yaml 
        sed -i "s@TRAINING_INSTRUCTOR@$TRAINING_INSTRUCTOR@" ~/training/dashboard/fscollector_student_deploy.yaml


        kubectl delete -f ~/training/dashboard/fscollector_student_deploy.yaml > /dev/null
        kubectl apply -f ~/training/dashboard/fscollector_student_deploy.yaml


        FOUND=0
        echo "${clock} Wait for Personal Training Environment to reach running state."
        while [ ${FOUND} -eq 0 ]; do
          FOUND=$(kubectl get pods | grep student | grep 1/1 | grep -c "")
          echo "${clock} Still waiting for Personal Training Environment to reach running state."
          sleep 10 
        done 

        minikube service student-ui

echo "${GREEN}----------------------------------------------------------------------------------------------------------------------------------------------------${NC}"
echo "${GREEN}----------------------------------------------------------------------------------------------------------------------------------------------------${NC}"
echo " ${GREEN}${healthy} DONE.... You're ready to go${NC}"
echo "${GREEN}----------------------------------------------------------------------------------------------------------------------------------------------------${NC}"
echo "${GREEN}----------------------------------------------------------------------------------------------------------------------------------------------------${NC}"
echo "${GREEN}----------------------------------------------------------------------------------------------------------------------------------------------------${NC}"
echo "${GREEN}----------------------------------------------------------------------------------------------------------------------------------------------------${NC}"
echo "${GREEN}***************************************************************************************************************************************************${NC}"
echo "${GREEN}***************************************************************************************************************************************************${NC}"
